{{- $gitea := (protonPassJSON "pass://Unbound Infrastructure/gitea").item.content.note -}}
{{- $auths := (protonPassJSON "pass://Personal/.auths").item.content.note -}}
{{- $slack := (protonPassJSON "pass://Unbound Infrastructure/slack").item.content.note -}}
gitea_token         = {{ regexFind "Terraform:[^\n]*" $gitea | trimPrefix "Terraform:" | trim | quote }}
gitlab_token        = {{ regexFind "GitlabTerraformToken:[^\n]*" $auths | trimPrefix "GitlabTerraformToken:" | trim | quote }}
anthropic_api_key   = {{ regexFind "AnthropicApiKey:[^\n]*" $gitea | trimPrefix "AnthropicApiKey:" | trim | quote }}
gitea_actions_token = {{ regexFind "GiteaActionsToken:[^\n]*" $gitea | trimPrefix "GiteaActionsToken:" | trim | quote }}
slack = {
  ops          = {{ regexFind "ops:[^\n]*" $slack | trimPrefix "ops:" | trim | quote }}
  gitlab_ci    = {{ regexFind "gitlabCi:[^\n]*" $slack | trimPrefix "gitlabCi:" | trim | quote }}
  dancefinder  = {{ regexFind "dancefinder:[^\n]*" $slack | trimPrefix "dancefinder:" | trim | quote }}
  shiny        = {{ regexFind "shiny:[^\n]*" $slack | trimPrefix "shiny:" | trim | quote }}
  hifi         = {{ regexFind "hifi:[^\n]*" $slack | trimPrefix "hifi:" | trim | quote }}
  eventsourced = {{ regexFind "eventsourced:[^\n]*" $slack | trimPrefix "eventsourced:" | trim | quote }}
  angus        = {{ regexFind "angus:[^\n]*" $slack | trimPrefix "angus:" | trim | quote }}
}
aws_access_key_id     = {{ regexFind "TerraformKey:[^\n]*" $gitea | trimPrefix "TerraformKey:" | trim | quote }}
aws_secret_access_key = {{ regexFind "TerraformSecret:[^\n]*" $gitea | trimPrefix "TerraformSecret:" | trim | quote }}
schemas_api_key       = {{ regexFind "SchemasApiKey:[^\n]*" $gitea | trimPrefix "SchemasApiKey:" | trim | quote }}
acctest_token         = {{ regexFind "AcctestToken:[^\n]*" $gitea | trimPrefix "AcctestToken:" | trim | quote }}
# BUILDTOOLS_CONTENT per organization for K8s deployments
# TODO: Fill in with actual deployment configuration
buildtools_shiny = <<-EOF
registry:
  gitea:
    registry: oci.unbound.se
    username: buildtools
    token: {{ regexFind "BuildtoolsToken:[^\n]*" $gitea | trimPrefix "BuildtoolsToken:" | trim }}
targets:
  staging:
    context: k8s.unbound.se
    namespace: shiny-staging
  prod:
    context: k8s.unbound.se
    namespace: shiny
cache:
  ecr:
    url: 724902258495.dkr.ecr.eu-west-1.amazonaws.com/buildcache
EOF

buildtools_dancefinder = <<-EOF
registry:
  gitea:
    registry: oci.unbound.se
    username: buildtools
    token: {{ regexFind "BuildtoolsToken:[^\n]*" $gitea | trimPrefix "BuildtoolsToken:" | trim }}
targets:
  prod:
    context: k8s.unbound.se
    namespace: dancefinder
cache:
  ecr:
    url: 724902258495.dkr.ecr.eu-west-1.amazonaws.com/buildcache
EOF

# Optional: Custom BUILDTOOLS_CONTENT for specific unboundsoftware repos
buildtools_custom = {
  "sites"     = <<-EOF
registry:
  gitea:
    registry: oci.unbound.se
    username: buildtools
    token: {{ regexFind "BuildtoolsToken:[^\n]*" $gitea | trimPrefix "BuildtoolsToken:" | trim }}
targets:
  prod:
    context: k8s.unbound.se
    namespace: sites
cache:
  ecr:
    url: 724902258495.dkr.ecr.eu-west-1.amazonaws.com/buildcache
EOF
  "container" = <<-EOF
registry:
  gitea:
    registry: oci.unbound.se
    username: buildtools
    token: {{ regexFind "BuildtoolsToken:[^\n]*" $gitea | trimPrefix "BuildtoolsToken:" | trim }}
cache:
  ecr:
    url: 724902258495.dkr.ecr.eu-west-1.amazonaws.com/buildcache
EOF
  "schemas"   = <<-EOF
registry:
  gitea:
    registry: oci.unbound.se
    username: buildtools
    token: {{ regexFind "BuildtoolsToken:[^\n]*" $gitea | trimPrefix "BuildtoolsToken:" | trim }}
targets:
  prod:
    context: k8s.unbound.se
    namespace: schemas
cache:
  ecr:
    url: 724902258495.dkr.ecr.eu-west-1.amazonaws.com/buildcache
EOF
}
